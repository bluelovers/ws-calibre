"use strict";
/**
 * Created by user on 2020/1/14.
 */
Object.defineProperty(exports, "__esModule", { value: true });
function pubdate(row) {
    if (row.pubdate) {
        row.pubdate = new Date(row.pubdate);
    }
    if (row.books && row.books.length) {
        row.books.forEach(pubdate);
    }
    return row;
}
function propertiesCollapser(arr, collapsedName, regex, sep = '|') {
    const keys = Object.keys(arr[0]).filter(propName => regex.test(propName));
    const firstKey = keys[0];
    return function collapse(row, index) {
        keys.forEach(function (propName) {
            row[propName] = (row[propName] && row[propName].split(sep)) || [];
        });
        row[collapsedName] = row[firstKey].map(function (id, index) {
            const element = {};
            keys.forEach(function (propName) {
                //const _propName = propName.replace(regex,'')
                element[propName] = row[propName][index];
            });
            return element;
        });
        keys.forEach(function (propName) { delete row[propName]; });
        return pubdate(row);
    };
}
exports.propertiesCollapser = propertiesCollapser;
exports.default = propertiesCollapser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydGllc0NvbGxhcHNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInByb3BlcnRpZXNDb2xsYXBzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQU9ILFNBQVMsT0FBTyxDQUFpQixHQUFNO0lBRXRDLElBQUksR0FBRyxDQUFDLE9BQU8sRUFDZjtRQUNDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQ3BDO0lBQ0QsSUFBSSxHQUFHLENBQUMsS0FBSyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUNqQztRQUNDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzNCO0lBQ0QsT0FBTyxHQUFHLENBQUM7QUFDWixDQUFDO0FBRUQsU0FBZ0IsbUJBQW1CLENBQUksR0FBUSxFQUFFLGFBQXFCLEVBQUUsS0FBYSxFQUFFLEdBQUcsR0FBRyxHQUFHO0lBRS9GLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQzFFLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixPQUFPLFNBQVMsUUFBUSxDQUFDLEdBQU0sRUFBRSxLQUFhO1FBRTdDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxRQUFRO1lBRTlCLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ25FLENBQUMsQ0FBQyxDQUFDO1FBQ0gsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEVBQUUsS0FBSztZQUV6RCxNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLFFBQVE7Z0JBRTlCLDhDQUE4QztnQkFDOUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sT0FBTyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLFFBQVEsSUFBRyxPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBO1FBQ3pELE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUMsQ0FBQTtBQUNGLENBQUM7QUF2QkQsa0RBdUJDO0FBRUQsa0JBQWUsbUJBQW1CLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDIwLzEvMTQuXG4gKi9cblxudHlwZSBJUm93ID0ge1xuXHRwdWJkYXRlPzogRGF0ZSxcblx0Ym9va3M/OiBJUm93W10sXG59XG5cbmZ1bmN0aW9uIHB1YmRhdGU8VCBleHRlbmRzIElSb3c+KHJvdzogVClcbntcblx0aWYgKHJvdy5wdWJkYXRlKVxuXHR7XG5cdFx0cm93LnB1YmRhdGUgPSBuZXcgRGF0ZShyb3cucHViZGF0ZSk7XG5cdH1cblx0aWYgKHJvdy5ib29rcyAmJiByb3cuYm9va3MubGVuZ3RoKVxuXHR7XG5cdFx0cm93LmJvb2tzLmZvckVhY2gocHViZGF0ZSk7XG5cdH1cblx0cmV0dXJuIHJvdztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnRpZXNDb2xsYXBzZXI8VD4oYXJyOiBUW10sIGNvbGxhcHNlZE5hbWU6IHN0cmluZywgcmVnZXg6IFJlZ0V4cCwgc2VwID0gJ3wnKVxue1xuXHRjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYXJyWzBdKS5maWx0ZXIocHJvcE5hbWUgPT4gcmVnZXgudGVzdChwcm9wTmFtZSkpO1xuXHRjb25zdCBmaXJzdEtleSA9IGtleXNbMF07XG5cdHJldHVybiBmdW5jdGlvbiBjb2xsYXBzZShyb3c6IFQsIGluZGV4OiBudW1iZXIpOiBUXG5cdHtcblx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKHByb3BOYW1lKVxuXHRcdHtcblx0XHRcdHJvd1twcm9wTmFtZV0gPSAocm93W3Byb3BOYW1lXSAmJiByb3dbcHJvcE5hbWVdLnNwbGl0KHNlcCkpIHx8IFtdO1xuXHRcdH0pO1xuXHRcdHJvd1tjb2xsYXBzZWROYW1lXSA9IHJvd1tmaXJzdEtleV0ubWFwKGZ1bmN0aW9uIChpZCwgaW5kZXgpXG5cdFx0e1xuXHRcdFx0Y29uc3QgZWxlbWVudCA9IHt9O1xuXHRcdFx0a2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wTmFtZSlcblx0XHRcdHtcblx0XHRcdFx0Ly9jb25zdCBfcHJvcE5hbWUgPSBwcm9wTmFtZS5yZXBsYWNlKHJlZ2V4LCcnKVxuXHRcdFx0XHRlbGVtZW50W3Byb3BOYW1lXSA9IHJvd1twcm9wTmFtZV1baW5kZXhdO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gZWxlbWVudDtcblx0XHR9KTtcblx0XHRrZXlzLmZvckVhY2goZnVuY3Rpb24gKHByb3BOYW1lKSB7ZGVsZXRlIHJvd1twcm9wTmFtZV07fSlcblx0XHRyZXR1cm4gcHViZGF0ZShyb3cpO1xuXHR9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHByb3BlcnRpZXNDb2xsYXBzZXJcbiJdfQ==